shared-controls:
  - reference-id: CCC
    identifiers:
      - CCC.C01 # Prevent Unencrypted Requests
      - CCC.C02 # Ensure Data Encryption at Rest
      - CCC.C03 # Enforce Multi-Factor Authentication
      - CCC.C04 # Log All Access and Changes
      - CCC.C05 # Prevent Access From Untrusted Entities
      - CCC.C06 # Prevent Deployment in Restricted Regions
      - CCC.C10 # Prevent Data Replication Outside Perimeter

control-families:
  - name: "Logging & Monitoring"
    description: |
      Controls that detect anomalous traffic and record load-balancer activity.

    controls:
      - id: CCC.LB.C01
        title: Enforce Rate Limiting
        objective: >
          Ensure malicious or excessive requests are throttled to prevent downstream resource exhaustion and brute-force activity.
        requirements:
          - id: CCC.LB.C01.TR01
            text: |
              When a client exceeds the configured request-rate threshold, the load balancer MUST throttle subsequent requests for at least 60 seconds and record the event in the access log.
            applicability:
              - tlp-green
              - tlp-amber
              - tlp-red
            recommendation: Configure per-IP token-bucket limits with CCC.LB.F22 and verify via synthetic traffic tests.
        threat-mappings:
          - reference-id: LB
            identifiers:
              - LB.TH01 # Malicious Traffic
              - LB.TH09 # Resource Exhaustion
        guideline-mappings:
          - reference-id: NIST-CSF
            identifiers:
              - DE.CM-1 # The network is monitored to detect events
          - reference-id: NIST_800_53
            identifiers:
              - AU-6 # Audit review, analysis, and reporting

      - id: CCC.LB.C06
        title: Secure Health-Check Telemetry
        objective: >
          Monitor health-check endpoints for tampering and alert on abnormal status changes.
        requirements:
          - id: CCC.LB.C06.TR01
            text: |
              When more than 10 percent of targets change from healthy to unhealthy within five minutes, an alert MUST be issued.
            applicability:
              - tlp-green
              - tlp-amber
              - tlp-red
            recommendation:
              Instrument metrics for CCC.LB.F12 and F13 transitions and set monitoring alarms.
        threat-mappings:
          - reference-id: LB
            identifiers:
              - LB.TH05 # Health Checks Exploited
        guideline-mappings:
          - reference-id: NIST-CSF
            identifiers:
              - DE.AE-2 # Detected events are analyzed
          - reference-id: NIST_800_53
            identifiers:
              - SI-4 # System monitoring

  - name: Identity and Access Management
    description: |
      Controls that restrict who can change or query load-balancer resources.
    controls:
      - id: CCC.LB.C04
        title: Enforce Distribution Policies
        objective: >
          Ensure traffic-splitting weights and algorithms are modified only by trusted identities.
        requirements:
          - id: CCC.LB.C04.TR01
            text: |
              When routing weights change, the request MUST originate from a role tagged "lb-ops" and be logged.
            applicability:
              - tlp-green
              - tlp-amber
              - tlp-red
            recommendation: Use IAM condition keys and audit logging.
        threat-mappings:
          - reference-id: LB
            identifiers:
              - LB.TH03 # Traffic Distribution Manipulated
        guideline-mappings:
          - reference-id: NIST-CSF
            identifiers:
              - PR.AC-1 # Identities and credentials are managed
          - reference-id: NIST_800_53
            identifiers:
              - AC-3 # Access enforcement

      - id: CCC.LB.C05
        title: Validate Session Affinity
        objective: >
          Configure session persistence to minimise fixation and hijacking
          risks.
        requirements:
          - id: CCC.LB.C05.TR01
            text: |
              When stickiness is enabled, session cookies MUST use SameSite=Lax and expire within 30 minutes of inactivity.
            applicability:
              - tlp-green
              - tlp-amber
              - tlp-red
            recommendation: Audit CCC.LB.F15 parameters via configuration scans.
        threat-mappings:
          - reference-id: LB
            identifiers:
              - LB.TH04 # Session Persistence Exploited
        guideline-mappings:
          - reference-id: NIST-CSF
            identifiers:
              - PR.AC-7 # Least functionality is enforced
          - reference-id: NIST_800_53
            identifiers:
              - SC-23 # Session authenticity

      - id: CCC.LB.C09
        title: Restrict Management API Access
        objective: >
          Limit load-balancer API calls to authorised identities and trusted networks.
        requirements:
          - id: CCC.LB.C09.TR01
            text: |
              When an API call originates outside the approved CIDR set, the request MUST be denied.
            applicability:
              - tlp-green
              - tlp-amber
              - tlp-red
            recommendation: Combine VPC endpoints with IAM condition-key filters
              for CCC.F14-protected APIs.
        threat-mappings:
          - reference-id: LB
            identifiers:
              - LB.TH08 # API Exposed and Attacked
        guideline-mappings:
          - reference-id: NIST-CSF
            identifiers:
              - PR.AC-5 # Network integrity is protected
          - reference-id: NIST_800_53
            identifiers:
              - SC-7 # Boundary protection

  - name: Data
    description: Controls that preserve availability and confidentiality of traffic processed by the load balancer.
    controls:
      - id: CCC.LB.C02
        title: Auto-Scale Load Balancer Capacity
        objective: >
          Expand load-balancer capacity to maintain availability during traffic
          spikes.
        requirements:
          - id: CCC.LB.C02.TR01
            text: |
              When concurrent connections reach 80 percent of capacity, the autoscaling group MUST add at least one instance within five minutes.
            applicability:
              - tlp-green
              - tlp-amber
              - tlp-red
            recommendation: Enable CCC.LB.F09 autoscaling policies.
        threat-mappings:
          - reference-id: LB
            identifiers:
              - LB.TH09 # Resource Exhaustion
        guideline-mappings:
          - reference-id: NIST-CSF
            identifiers:
              - ID.BE-5 # Resilience requirements are established
          - reference-id: NIST_800_53
            identifiers:
              - CP-10 # System recovery and reconstitution

      - id: CCC.LB.C07
        title: Scrub Sensitive Headers
        objective: >
          Remove headers that disclose internal details or software versions from HTTP responses.
        requirements:
          - id: CCC.LB.C07.TR01
            text: |
              When responses pass through the load balancer, the "Server" header MUST be replaced with "lb".
            applicability:
              - tlp-green
              - tlp-amber
              - tlp-red
            recommendation: Configure header-transformation rules (CCC.LB.F19).
        threat-mappings:
          - reference-id: LB
            identifiers:
              - LB.TH06 # Metadata Exposure
        guideline-mappings:
          - reference-id: NIST-CSF
            identifiers:
              - PR.DS-2 # Data in transit is protected
          - reference-id: NIST_800_53
            identifiers:
              - SC-13 # Cryptographic protection

  - name: Encryption
    description: Controls that ensure trustworthy TLS certificates and ciphers.
    controls:
      - id: CCC.LB.C08
        title: Automate Certificate Renewal
        objective: >
          Maintain valid TLS certificates by automating renewal and deployment before expiry.
        requirements:
          - id: CCC.LB.C08.TR01
            text: |
              When a certificate is within 30 days of expiry, automated renewal MUST complete and deploy a new certificate within 24 hours.
            applicability:
              - tlp-green
              - tlp-amber
              - tlp-red
            recommendation: Use certificate-manager auto-renewal workflows.
        threat-mappings:
          - reference-id: LB
            identifiers:
              - LB.TH07 # Certificates Expired or Invalid
        guideline-mappings:
          - reference-id: NIST-CSF
            identifiers:
              - PR.DS-6 # Integrity checking mechanisms are used
          - reference-id: NIST_800_53
            identifiers:
              - SC-17 # PKI certificates
