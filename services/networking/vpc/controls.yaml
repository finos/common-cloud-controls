common_controls:
  - CCC.C01  # Prevent unencrypted requests
  - CCC.C03  # Implement multi-factor authentication (MFA) for access
  - CCC.C04  # Log all access and changes
  - CCC.C05  # Prevent access from untrusted entities
  - CCC.C06  # Prevent deployment in restricted regions

controls:
  - id: CCC.VPC.C01
    title: Skip Default Network Creation
    objective: |
      Prevent the automatic creation of default virtual networks and related resources during cloud project initialization to avoid insecure default configurations and enforce custom network policies.
    control_family: Network Security
    threats:
      - CCC.VPC.TH01
      - CCC.TH01  # Access control is misconfigured (common threat)
    nist_csf: PR.AC-5
    control_mappings:
      CCM:
        - TVM-02
      ISO_27001:
        - 2013 A.12.3.1
      NIST_800_53:
        - SC-7
    test_requirements:
      - id: CCC.VPC.C01.TR01
        # TO DO: When a new project/account/subscription is created, then default networks are not automatically created.
        text: |
          Verify that default networks are not automatically created upon project initialization.
        tlp_levels:
          - tlp_red
      - id: CCC.VPC.C01.TR02
        text: |
          Confirm that only custom networks with appropriate security controls are in place.
        tlp_levels:
          - tlp_red

  - id: CCC.VPC.C02
    title: Limit External IP Addresses for Virtual Machines
    objective: |
      Restrict the assignment of external (public) IP addresses to virtual machines to reduce exposure to the public internet and minimize attack surfaces.
    control_family: Network Security
    threats:
      - CCC.VPC.TH02
      - CCC.TH02  # Data is intercepted in transit (common threat)
    nist_csf: PR.AC-3
    control_mappings:
      CCM:
        - SEF-05
      ISO_27001:
        - 2013 A.13.1.1
      NIST_800_53:
        - AC-4
    test_requirements:
      - id: CCC.VPC.C02.TR01
        text: |
          When assigning IP addresses within VPCs, then IP ranges MUST be private.
        tlp_levels:
          - tlp_red
      # TO DO: Remove CCC.VPC.C02.TR02?
      - id: CCC.VPC.C02.TR02
        text: |
          Ensure that external IP assignments are approved and monitored for virtual machines without sensitive data.
        tlp_levels:
          - tlp_green

  - id: CCC.VPC.C03
    title: Restrict IP Forwarding on Virtual Machines
    objective: |
      Control the use of IP forwarding on virtual machines to prevent unauthorized network traffic routing and potential security risks.
    control_family: Network Security
    threats:
      - CCC.VPC.TH03
    nist_csf: PR.AC-5
    control_mappings:
      CCM:
        - SEF-05
      ISO_27001:
        - 2013 A.13.1.1
      NIST_800_53:
        - SC-7
    test_requirements:
      - id: CCC.VPC.C03.TR01
        text: |
          When a VPC peering connection is requested for an untrusted
          destination, the VPCâ€™s peering configuration MUST remain unchanged.
        tlp_levels:
          - tlp_red
      - id: CCC.VPC.C03.TR02
        text: |
          When an attempt is made to enable IP forwarding on a VM, then the VM configuration MUST remain unchanged.
        tlp_levels:
          - tlp_red
      - id: CCC.VPC.C03.TR03
      # TO DO: Remove? Is this testable?
        text: |
          Confirm that IP forwarding is only enabled on virtual machines without sensitive data and with a justified operational need.
        tlp_levels:
          - tlp_green
      # TO DO: Remove? Is this testable?
      - id: CCC.VPC.C03.TR04
        text: |
          Review and document the instances where IP forwarding is enabled under TLP Green classification.
        tlp_levels:
          - tlp_green
  # TO DO: Remove? This is written is a way that it is specific to ML.
  - id: CCC.VPC.C04
    title: Restrict Public IP Access to ML Development Environments
    objective: |
      Prevent public IP access to Machine Learning (ML) development environments (e.g., ML notebooks) to reduce exposure to the internet and enhance security.
    control_family: Network Security
    threats:
      - CCC.VPC.TH04
    nist_csf: PR.AC-3
    control_mappings:
      CCM:
        - SEF-05
      ISO_27001:
        - 2013 A.13.1.1
      NIST_800_53:
        - SC-7
    test_requirements:
      - id: CCC.VPC.C04.TR01
        text: |
          Verify that ML development environments containing sensitive data cannot be accessed via public IP addresses.
        tlp_levels:
          - tlp_red
      - id: CCC.VPC.C04.TR02
        text: |
          Attempt to access an ML notebook via a public IP and confirm that access is denied.
        tlp_levels:
          - tlp_red
      - id: CCC.VPC.C04.TR03
        text: |
          Ensure that any ML development environments without sensitive data requiring public access are approved and have appropriate security controls.
        tlp_levels:
          - tlp_green
  # TO DO: Remove? This is written is a way that it is specific to ML.
  - id: CCC.VPC.C05
    title: Restrict Virtual Networks for ML Development Environments
    objective: |
      Limit the virtual networks that can be used when creating new ML development environment instances to ensure they are deployed within approved and secure network environments.
    control_family: Network Security
    threats:
      - CCC.VPC.TH05
      - CCC.TH01  # Access control is misconfigured (common threat)
    nist_csf: PR.AC-4
    control_mappings:
      CCM:
        - IAM-12
      ISO_27001:
        - 2013 A.9.1.2
      NIST_800_53:
        - AC-6
    test_requirements:
      - id: CCC.VPC.C05.TR01
        text: |
          Verify that ML development environments containing sensitive data can only be deployed in approved virtual networks with appropriate security controls.
        tlp_levels:
          - tlp_red
      - id: CCC.VPC.C05.TR02
        text: |
          Attempt to deploy an ML development environment in an unapproved network and confirm that it is denied.
        tlp_levels:
          - tlp_red
      - id: CCC.VPC.C05.TR03
        text: |
          Ensure that ML development environments without sensitive data are deployed in networks that meet organizational security standards.
        tlp_levels:
          - tlp_green
  # TO DO: Remove? Nested virtualization is not a feature of VPCs.
  - id: CCC.VPC.C06
    title: Disable Nested Virtualization on Virtual Machines
    objective: |
      Disable hardware-accelerated nested virtualization on virtual machines to prevent potential security risks associated with nested environments.
    control_family: Virtualization Security
    threats:
      - CCC.VPC.TH06
      - CCC.TH06  # Data is lost or corrupted (common threat)
    nist_csf: PR.DS-7
    control_mappings:
      CCM:
        - IVS-08
      ISO_27001:
        - 2013 A.12.6.2
      NIST_800_53:
        - SC-7
    test_requirements:
      - id: CCC.VPC.C06.TR01
        text: |
          Verify that nested virtualization cannot be enabled on virtual machines containing sensitive data.
        tlp_levels:
          - tlp_red
      - id: CCC.VPC.C06.TR02
        text: |
          Attempt to enable nested virtualization on a sensitive VM and confirm that it is denied.
        tlp_levels:
          - tlp_red
      - id: CCC.VPC.C06.TR03
        text: |
          For virtual machines without sensitive data, ensure that nested virtualization is only enabled when necessary and with appropriate security measures.
        tlp_levels:
          - tlp_green

  - id: CCC.VPC.C07
    title: Restrict VPC Peering to Authorized Accounts
    objective: |
      Ensure VPC peering connections are only established with explicitly authorized destinations to limit network exposure and enforce boundary controls.
    control_family: Network Security
    threats:
      - CCC.VPC.TH07
    nist_csf: PR.AC-3
    control_mappings:
      CCM:
        - IVS-01
      ISO_27001:
        - 2013 A.13.1.3
      NIST_800_53:
        - AC-4
    test_requirements:
      - id: CCC.VPC.C07.TR01
        text: |
          When a VPC peering connection request is made, then it MUST be prevented if the target destination is not on an approved authorized list.
        tlp_levels:
          - tlp_red

  - id: CCC.VPC.C08
    title: Enforce VPC Flow Logs on VPCs.
    objective: |
      Ensure VPCs are configured with flow logs enabled to capture traffic information, support auditing, and enhance network visibility and security.
    control_family: Network Security
    threats:
      - CCC.VPC.TH08
    nist_csf: PR.PT-1
    control_mappings:
      CCM:
        - IVS-06
      ISO_27001:
        - 2013 A.12.4.1
      NIST_800_53:
        - AU-2
    test_requirements:
      - id: CCC.VPC.C08.TR01
        text: |
          When any network traffic goes to or from an interface in the VPC, VPC flow logs MUST capture and log all relevant information.
        tlp_levels:
          - tlp_red
      - id: CCC.VPC.C08.TR02
        text: |
          When VPC flow logs are disabled, then an alert MUST trigger.
        tlp_levels:
          - tlp_red

  - id: CCC.VPC.C09
    title: Restrict Route Table Entries from Internet Gateway Access
    objective: |
      Ensure that route tables do not contain routes to an Internet Gateway.
    control_family: Network Security
    threats:
      - CCC.VPC.TH09
    nist_csf: PR.AC-5
    control_mappings:
      CCM:
        - DSI-04
      ISO_27001:
        - 2013 A.13.1.3
      NIST_800_53:
        - SC-7
    test_requirements:
      - id: CCC.VPC.C09.TR01
        text: |
          When a route table is created or updated, then it MUST NOT include a route to an Internet Gateway.
        tlp_levels:
          - tlp_red
      - id: CCC.VPC.C09.TR02
        text: |
          When an unauthorized route to an Internet Gateway is detected in any route table, then an alert MUST trigger.
        tlp_levels:
          - tlp_red

  
